<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>MWMAP - 초기 화면</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <script>
    (function(){ if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) document.body.classList.add('standalone'); })();
  </script>
  <script>
    (function () {
      var isStandalone = window.matchMedia('(display-mode: standalone)').matches || !!window.navigator.standalone;
      function setVh() {
        var h = isStandalone ? window.innerHeight : (window.visualViewport && window.visualViewport.height) || window.innerHeight;
        document.documentElement.style.setProperty('--vh', h + 'px');
      }
      setVh();
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', setVh);
        window.visualViewport.addEventListener('scroll', setVh);
      }
      window.addEventListener('resize', setVh);
      window.addEventListener('orientationchange', function () {
        setTimeout(setVh, 50);
        setTimeout(setVh, 200);
      });
      window.addEventListener('pageshow', function (e) { if (e.persisted) setVh(); });
      if (isStandalone) {
        setTimeout(setVh, 0);
        setTimeout(setVh, 100);
        setTimeout(setVh, 400);
      }
      window.__setVh = setVh;
    })();
  </script>
  <div id="app-root">
    <div id="map"></div>
    <button type="button" id="project-btn" title="프로젝트">P</button>
    <div id="project-panel-overlay" aria-hidden="true"></div>
    <div id="project-panel" class="hide">
      <div id="project-panel-search">
        <input type="text" id="address-input" placeholder="위치검색" autocomplete="off">
      </div>
      <div id="project-sites-header">
        <span class="sync-badge hide" id="sync-badge" aria-live="polite">동기화됨</span>
      </div>
      <div id="project-sites-list"></div>
      <button type="button" id="add-site-btn">+ 현장추가</button>
    </div>
    <div id="zoom-controls">
      <button type="button" id="zoom-in-btn" title="확대">+</button>
      <button type="button" id="zoom-out-btn" title="축소">−</button>
    </div>
  </div>

  <!-- 새 현장 추가 모달 (X 없음, 모달 외 터치 시 닫기) -->
  <div id="add-site-overlay" aria-hidden="true">
    <div id="add-site-dialog" role="dialog" aria-labelledby="add-site-dialog-title">
      <h3 id="add-site-dialog-title">새 현장 추가</h3>
      <input type="text" id="add-site-title" placeholder="현장 이름" autocomplete="off" aria-label="현장 이름">
      <button type="button" id="add-site-submit">추가</button>
    </div>
  </div>

  <!-- 위치검색 결과 선택 모달 -->
  <div id="address-select-dialog">
    <div class="dialog-inner">
      <div class="dialog-header">
        <h3 id="address-dialog-title">검색 결과</h3>
        <button type="button" class="dialog-close" id="address-dialog-close" title="닫기">&times;</button>
      </div>
      <div id="address-select-list"></div>
    </div>
  </div>

  <!-- 전역 설정 → Firebase 초기화(compat 스크립트로 file://·로컬 서버 모두 동작) → 모듈 → 진입점 -->
  <script src="config.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore-compat.js"></script>
  <script src="firebase-init.js"></script>
  <script src="map-init.js"></script>
  <script src="map-search.js"></script>
  <script src="ui-panel.js"></script>
  <script src="sites.js"></script>
  <script src="app.js"></script>
  <!-- Google Maps API: callback=initMap 으로 진입 -->
  <script>
    (function () {
      var C = window.MWMAP_CONFIG || {};
      if (!C.GMAPS_API_KEY) {
        console.error('MWMAP_CONFIG.GMAPS_API_KEY 가 설정되지 않았습니다.');
        return;
      }
      var s = document.createElement('script');
      s.src = 'https://maps.googleapis.com/maps/api/js?key=' +
        encodeURIComponent(C.GMAPS_API_KEY) +
        '&libraries=geometry,places&callback=initMap&loading=async';
      s.async = true;
      s.defer = true;
      document.head.appendChild(s);
    })();
  </script>
</body>
</html>

